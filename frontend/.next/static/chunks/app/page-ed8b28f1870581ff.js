(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6726:function(e,s,t){Promise.resolve().then(t.bind(t,314))},314:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return y}});var a=t(7821),r=t(8078),l=t(981),n=t(3545),i=t(5699),d=t(2430),o=t(8500),c=t(8156),u=t(9024),m=t(9044),h=e=>{let{onDrop:s,onRejected:t,isDragging:l,setIsDragging:n,file:h,previewUrl:x,onPredict:p,canPredict:g,onReset:b}=e,j=(0,r.useRef)(null),{getRootProps:f,getInputProps:v,isDragActive:w,isDragReject:N}=(0,o.uI)({onDrop:s,onDropRejected:t,accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg"]},maxSize:10485760,multiple:!1});return(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsxs)("div",(0,d._)((0,i._)({},f({className:"rounded-2xl border-2 border-dashed p-6 transition cursor-pointer ".concat(N?"border-red-400 bg-red-500/10":w||l?"border-brand-500 bg-brand-500/5 ring-4 ring-brand-500/30":"border-white/10"),onDragEnter:()=>n(!0),onDragLeave:()=>n(!1)})),{children:[(0,a.jsx)("input",(0,i._)({},v({"aria-label":"Image upload dropzone"}))),(0,a.jsx)("div",{className:"grid place-items-center gap-2 text-center min-h-[220px]",children:x?(0,a.jsxs)("div",{className:"grid gap-2 w-full",children:[(0,a.jsx)("img",{src:x,alt:(null==h?void 0:h.name)||"Selected image preview",className:"max-h-96 w-auto max-w-full rounded-xl border border-white/10 object-contain bg-slate-950"}),(0,a.jsxs)("div",{className:"flex justify-between text-slate-400 text-sm",children:[(0,a.jsx)("p",{className:"truncate max-w-[70%]",title:null==h?void 0:h.name,children:null==h?void 0:h.name}),(0,a.jsx)("p",{children:function(e){if(0===e)return"0 B";let s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["B","KB","MB","GB"][s]}((null==h?void 0:h.size)||0)})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-14 h-14 grid place-items-center text-brand-500 bg-brand-500/20 rounded-full",children:(0,a.jsx)(c.Z,{size:36})}),(0,a.jsx)("p",{className:"font-semibold",children:"Drag & drop image here"}),(0,a.jsx)("p",{className:"text-slate-400 -mt-1",children:"PNG, JPG up to 10MB"}),(0,a.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-brand-500 hover:bg-brand-600 text-white",onClick:()=>{var e;return null===(e=j.current)||void 0===e?void 0:e.click()},"aria-label":"Browse files",children:[(0,a.jsx)(u.Z,{size:16}),(0,a.jsx)("span",{children:"Browse Files"})]})]})})]})),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 px-4 py-2 rounded-md bg-brand-500 hover:bg-brand-600 text-white disabled:opacity-60",onClick:p,disabled:!g,"aria-disabled":!g,children:[(0,a.jsx)(u.Z,{size:16}),(0,a.jsx)("span",{children:"Predict"})]}),(0,a.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 px-4 py-2 rounded-md border border-white/10 hover:bg-white/10 disabled:opacity-60",onClick:b,disabled:!h,children:[(0,a.jsx)(m.Z,{size:16}),(0,a.jsx)("span",{children:"Clear"})]})]}),(0,a.jsx)("input",{ref:j,type:"file",accept:"image/png, image/jpeg",className:"hidden",onChange:e=>{var t;return(null===(t=e.target.files)||void 0===t?void 0:t[0])&&s([e.target.files[0]])}})]})},x=e=>{let{results:s}=e,{predictions:t=[],processing_time:r}=s||{};return(0,a.jsxs)("div",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-slate-900 to-slate-950 p-5 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-baseline justify-between gap-2",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Results"}),"number"==typeof r&&(0,a.jsxs)("span",{className:"text-slate-400",children:["Processed in ",r.toFixed(2),"s"]})]}),0===t.length?(0,a.jsx)("p",{className:"text-slate-400 mt-2",children:"No predictions available."}):(0,a.jsx)("ul",{className:"grid gap-3 mt-3",children:t.map((e,s)=>(0,a.jsxs)("li",{className:"grid gap-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{className:"font-semibold",children:["Class ",e.class_id]}),(0,a.jsxs)("span",{className:"text-slate-400",children:[(100*e.confidence).toFixed(1),"%"]})]}),(0,a.jsx)("div",{className:"h-2 rounded-full bg-white/10 overflow-hidden border border-white/10",children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-brand-500 to-blue-300",style:{width:Math.max(0,Math.min(100,Math.round(100*e.confidence)))+"%"}})})]},s))})]})},p=e=>{let{label:s="Loading...",variant:t="default",etaSec:r,cancelable:l=!1,onCancel:n}=e;return(0,a.jsxs)("div",{style:{display:"grid",gap:8,justifyItems:"center"},"data-variant":t,children:[(0,a.jsxs)("div",{className:"spinner",role:"status","aria-live":"polite","aria-label":s,children:[(0,a.jsx)("div",{className:"dot"}),(0,a.jsx)("div",{className:"dot"}),(0,a.jsx)("div",{className:"dot"})]}),(0,a.jsxs)("div",{className:"muted",style:{fontSize:14},children:[s,"number"==typeof r?" • ~".concat(Math.ceil(r),"s"):""]}),l&&(0,a.jsx)("button",{type:"button",className:"btn btn-ghost btn-sm",onClick:n,children:"Cancel"})]})};let g=e=>"green"===e?"#22c55e":"yellow"===e?"#f59e0b":"#ef4444";var b=e=>{let{status:s,responseTime:t,message:r,onRetry:l}=e;return(0,a.jsxs)("div",{className:"server-status",role:"status","aria-live":"polite",children:[(0,a.jsx)("span",{className:"status-dot",style:{backgroundColor:g(s)},"aria-hidden":"true"}),(0,a.jsxs)("span",{className:"status-text",children:[s.toUpperCase()," ","number"==typeof t?"• ".concat(Math.round(t),"ms"):""]}),r?(0,a.jsxs)("span",{className:"muted",children:["— ",r]}):null,l&&(0,a.jsx)("button",{type:"button",className:"btn btn-ghost btn-sm",onClick:l,"aria-label":"Retry connection",children:"Retry"})]})},j=t(9190);let f={predict:"/predict",health:"/health"};t(1219);let v=j.Z.create({baseURL:"https://your-render-service.onrender.com",timeout:6e4});async function w(){try{var e,s;let t=await v.get(f.health,{timeout:5e3}),a=200===t.status&&((null===(e=t.data)||void 0===e?void 0:e.status)==="ok"||(null===(s=t.data)||void 0===s?void 0:s.success));return{ok:a,message:a?"":"Backend health check failed"}}catch(e){return{ok:!1,message:"Backend unreachable"}}}v.interceptors.response.use(e=>e,e=>("Network Error"!==e.message||e.response||(e.message="Network error: Unable to reach backend."),Promise.reject(e))),v.interceptors.request.use(async e=>{try{var s;let{data:t}=await null.auth.getSession(),a=null==t?void 0:null===(s=t.session)||void 0===s?void 0:s.access_token;a&&(e.headers=e.headers||{},e.headers.Authorization="Bearer ".concat(a))}catch(e){}return e});let N=async(e,s)=>{let t=new FormData;return t.append("file",e),v.post(f.predict,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:s})};function y(){let[e,s]=(0,r.useState)(null),[t,i]=(0,r.useState)(""),[d,o]=(0,r.useState)(!1),[c,u]=(0,r.useState)(!1),[m,g]=(0,r.useState)(null),[j,f]=(0,r.useState)(""),[v,y]=(0,r.useState)({ok:!0,message:""}),[k,C]=(0,r.useState)(0),[S,R]=(0,r.useState)(void 0),[B,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{},[]);let P=async()=>{f("Authentication not configured")},_=async()=>{};(0,r.useEffect)(()=>{let e=!0,s=async()=>{try{let s=performance.now(),t=await w();if(!e)return;y(t),R(performance.now()-s)}catch(s){if(!e)return;y({ok:!1,message:"Backend unreachable"}),R(void 0)}};s();let t=setInterval(s,15e3);return()=>{e=!1,clearInterval(t)}},[]),(0,r.useEffect)(()=>{if(!e)return;let s=URL.createObjectURL(e);return i(s),()=>URL.revokeObjectURL(s)},[e]);let E=(0,r.useCallback)(e=>{(null==e?void 0:e.length)&&(f(""),g(null),s(e[0]))},[]),z=(0,r.useCallback)(e=>{var s;(null==e?void 0:e.length)&&f((null===(s=e[0].errors)||void 0===s?void 0:s.map(e=>e.message).join(", "))||"File rejected")},[]),D=(0,r.useCallback)(()=>{s(null),i(""),g(null),f("")},[]),U=(0,r.useMemo)(()=>!!e&&!c,[e,c]),F=e=>new Promise(s=>setTimeout(s,e)),L=(0,r.useCallback)(async()=>{var s,t,a,r,l;if(!e){f("Please select an image first.");return}u(!0),f(""),g(null),C(0);try{let r=performance.now(),l=null;for(let n=1;n<=3;n++)try{let t=await N(e,e=>{let s=e.total;s&&C(Math.round(e.loaded/s*100))}),a=(performance.now()-r)/1e3,n=t.data;if(!(null==n?void 0:n.success))throw Error((null==n?void 0:n.message)||"Prediction failed");g({predictions:n.predictions||[],processing_time:null!==(s=n.processing_time)&&void 0!==s?s:a}),l=null;break}catch(s){l=s;let e="ECONNABORTED"===s.code||(null===(t=s.message)||void 0===t?void 0:t.toLowerCase().includes("network"))||[502,503,504].includes(null===(a=s.response)||void 0===a?void 0:a.status);if(n<3&&e){let e=1e3*Math.pow(2,n-1)+500*Math.random();await F(e);continue}throw s}if(l)throw l}catch(e){f("ECONNABORTED"===e.code?"Request timed out. The backend may be waking up (Render cold start). Please try again in a few seconds.":(null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||e.message||"An error occurred during prediction.")}finally{u(!1)}},[e]);return(0,a.jsxs)("div",{className:"min-h-screen text-slate-200 bg-[linear-gradient(180deg,#0f172a,#0b1020_60%)]",children:[(0,a.jsx)("header",{className:"py-8",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto px-4",children:[(0,a.jsx)("h1",{className:"m-0 text-3xl font-bold tracking-tight",children:"Computer Vision Demo"}),(0,a.jsx)("p",{className:"mt-1 text-slate-400",children:"Upload an image to get AI predictions"}),(0,a.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,a.jsx)(b,{status:v.ok?"green":"yellow",responseTime:S,message:v.ok?"":"Service may be cold starting",onRetry:()=>y({ok:!0,message:""})}),(0,a.jsx)("div",{children:B?(0,a.jsx)("button",{className:"px-3 py-1.5 rounded-md border border-white/10 hover:bg-white/10 text-sm",onClick:_,"aria-label":"Sign out",children:"Sign out"}):(0,a.jsx)("button",{className:"px-3 py-1.5 rounded-md bg-brand-500 hover:bg-brand-600 text-white text-sm",onClick:P,"aria-label":"Sign in",children:"Sign in"})})]})]})}),(0,a.jsxs)("main",{className:"max-w-3xl mx-auto px-4 grid gap-4",children:[!v.ok&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-xl border border-yellow-200/30 bg-yellow-500/10 text-yellow-100",role:"status","aria-live":"polite",children:[(0,a.jsx)(l.Z,{size:18}),(0,a.jsx)("span",{children:v.message||"Backend may be cold starting. First request can take up to a minute on free tier."})]}),(0,a.jsx)("section",{className:"rounded-2xl border border-white/10 bg-gradient-to-b from-slate-900 to-slate-950 p-5 shadow-xl",children:(0,a.jsx)(h,{onDrop:E,onRejected:z,isDragging:d,setIsDragging:o,file:e,previewUrl:t,onPredict:L,canPredict:U,onReset:D})}),(0,a.jsxs)("section",{className:"grid gap-3",children:[c&&(0,a.jsxs)("div",{className:"grid gap-2 place-items-center text-center p-4",children:[(0,a.jsx)(p,{}),(0,a.jsx)("p",{className:"text-slate-400",children:"Processing... This may take a bit if the backend is waking up."}),k>0&&(0,a.jsx)("div",{className:"h-2 w-full rounded-full bg-white/10 overflow-hidden","aria-label":"Upload progress","aria-valuenow":k,"aria-valuemin":0,"aria-valuemax":100,children:(0,a.jsx)("div",{className:"h-full bg-gradient-to-r from-brand-500 to-blue-300",style:{width:"".concat(k,"%")}})})]}),!!j&&(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 rounded-xl border border-red-200/30 bg-red-500/10 text-red-100",role:"alert",children:[(0,a.jsx)(l.Z,{size:18}),(0,a.jsx)("span",{children:j})]}),!c&&!j&&m&&(0,a.jsx)(x,{results:m})]})]}),(0,a.jsxs)("footer",{className:"max-w-3xl mx-auto px-4 py-6 flex items-center justify-between text-slate-400",children:[(0,a.jsxs)("div",{className:"inline-flex gap-2 items-center",children:[(0,a.jsx)(n.Z,{size:16}),(0,a.jsx)("span",{children:"Backend: auto-detected • Uses health checks and retries"})]}),(0,a.jsx)("button",{className:"text-blue-300 hover:underline bg-transparent border-0 cursor-pointer",children:"Docs"})]})]})}}},function(e){e.O(0,[734,115,364,744],function(){return e(e.s=6726)}),_N_E=e.O()}]);